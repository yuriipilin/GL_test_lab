 
# Automation of searching for installed packages with vulnerabilities for the different Linux distros

## Project explained
By Using  automation server to execute the process of finding and fixing the vulnerabilities on given hosts<br>
The network scanner is looking for installed packages with vulnerabilities.<br> The report it creates is used to make a configuration which is applyed to previously scanned linux hosts<br> To fix vulnerabilities that was found.
## The main Tools/frameworks used
* [Jenkins](https://www.jenkins.io/) to perform all tasks needed to meet project requirement.
* [Nessus Essentials](https://www.tenable.com/) To scan linux hosts for list of installed packages with vulnerabilities<br> And generation of the report which is used to create Ansible playbook
* [Python](https://www.python.org/) with jinja2 framework to create Ansible pattern
* [Ansible](https://www.ansible.com/) To run perform needed tasks order to fix each vulnerable host.

##Installation/Requirements 
Make sure you distro has python3 on board
in order to run the project<br> You also need to install and configure Jenkins, Ansible and Nessus scanner(all tool provides quick start guides)<br>
For python install the folowing packages with python pip:<br>
1. selenium <br>
2. jinja2 <br>

```shell
$ mkdir %foldername%
$ git clone https://github.com/yuriipilin/GL_test_lab
$ cd %your_folder_name%
```

## How to run
Before you run place private ssh key for scanned hosts into the runNessuss folder<br>
Make sure you also have the report file with the name "scanned.csv" generated with nessus scanner is the project root directory.<br>

```shell
$ python3 crerate_pattern_ansible.py  - to create ansible playbook
```
Then inside the ansible forlder run <br>

```shell
$ ansible-playbook fixVulnerabilities.yml
```

### To create and run new nessus scan without GUI(see TODO)
```shell
$ cd runNessus
$ run_Nessus_selenium.py %any_nessus_scan_name% %nessus_scan_ssh_user%
```

## Project structure explained
* crerate_pattern_ansible.py - a script to generate playbook file using jinja2
* ansible directory - contains necessary config and generated playbook
  * ansible.cfg - ansible default config file
  * fixVulnerabilities.yml - ansible playbook file generated by crerate_pattern_ansible.py script
  * hosts - a file contains list of hosts needs to be updated generated by crerate_pattern_ansible.py script

* jinjaTemplates a folder for template patterns nedded to jinja framework
  * template - template for jinja2 to create ansible playbook

* scanned.csv - report provided by Nessus scanner
* terraform a folder contains Terraform config file to create some VM's(***see "additional tools"*** )
  *  mkservers.tf - config file to create some VM instances in Goolgle Cloud

* runNessus folder contains an attempt to run nessus scan with python selenium webdriver
  *  hosts_to_scan.txt - a file that need to be filled by hands with host IPs separated by comma(16 hosts at MAX for Nessus Essential)
  *  run_Nessus_selenium.py  -script to automate Nessus scan process

## Additional tools
 In order to run it install [Terraform](https://www.terraform.io/) and [google cloud SDK](https://cloud.google.com/sdk/docs/install)<br>
 Terraform is handy way to create Google cloud and AWS VM instanes in any numbers
 For example by running<br>
 To run it you need to place your *.json key generated for Google cloud project inside the folder<br>
 Than edit mkserver.tf file

 ```
 provider "google" {
 credentials = file("%your_key_name%.json")
 project     = "%your_project_name%"
 region      = "%VM_instances_region%"
}
 
 ``` 
 
 
  then run:

 ```shell
$ terraform init
$ terraform apply
```

It creates 2 VM instances in your Google Cloud account with pre-installed and running apache on them.<br> VMs also have configured extern IPs and 443/80 ports open to outside.

## TODO
[X] Complete  run_Nessus_selenium.py script to run Nessus scan with python-selenium and chrome-headless<br> It still can't add ssh key to new scan <br>
[X] python3 crerate_pattern_ansible.py script have to be tested with different distro and improved to match more than one package at time. For now it can process only one package for Ubuntu and RHEL based linux distros<br>
...<br>
TBC